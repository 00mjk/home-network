# Default fail
server {
    listen 80       default_server;
    server_name     _;
    return          404;
}

server {
    listen                  443 ssl default_server;
    server_name             _;

    ssl_certificate         /etc/ssl/certs/external/tls.crt;
    ssl_certificate_key     /etc/ssl/certs/external/tls.key;

    return                  404;
}

# Certbot
server {
    server_name         aleemhaji.com;
    listen              80;

    location / {
        proxy_pass      http://certbot;
    }
}

# The internal wildcard cert uses a TXT record, so this is just for naked
#   subdomain, if I ever host anything there.
server {
    server_name     internal.aleemhaji.com;
    listen 80;

    location / {
        proxy_pass  http://certbot;
    }
}

# Remindmebot
server {
    listen          80;
    server_name     remindmebot remindmebot.home remindmebot.aleemhaji.com remindmebot.internal.aleemhaji.com;
    return          302 https://remindmebot.aleemhaji.com$request_uri;
}

server {
    server_name             remindmebot.aleemhaji.com;
    listen                  443 ssl;

    ssl_certificate         /etc/ssl/certs/external/tls.crt;
    ssl_certificate_key     /etc/ssl/certs/external/tls.key;

    location / {
        proxy_set_header    Host $host;
        proxy_pass          http://remindmebot;
    }
}
